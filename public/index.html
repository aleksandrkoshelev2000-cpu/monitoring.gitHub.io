<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мониторинг заболеваемости</title>
    <style>
        /* ваши стили */
    </style>
</head>
<body>
    <button class="admin-button" onclick="openAdminPage()">Для администратора</button>
    <h2>Мониторинг заболеваемости</h2>
    <table id="mainTab">
        <tr>
            <th>Класс</th>
            <th>Классный руководитель</th>
            <th>Всего учащихся</th>
            <th>Отсутствуют по болезни</th>
            <th>Действие</th>
        </tr>
        <tr>
            <td>1А</td>
            <td>Жемчуева О.А.</td>
            <td>33</td>
            <td contenteditable="true" data-class="1А" onblur="calculateSums()" id="absent-1А">0</td>
            <td><button class="save-button" onclick="saveData('1А', this)">Сохранить</button></td>
        </tr>
        <tr>
            <td>2А</td>
            <td>Каржавина Т.А.</td>
            <td>27</td>
            <td contenteditable="true" data-class="2А" onblur="calculateSums()" id="absent-2А">0</td>
            <td><button class="save-button" onclick="saveData('2А', this)">Сохранить</button></td>
        </tr>
        <tr>
            <td></td>
            <td>Всего</td>
            <td id="sumTotalStudents">0</td>
            <td id="sumTotalAbsent">0</td>
        </tr>
    </table>

    <script>
        function calculateSums() {
            const table = document.getElementById('mainTab');
            const rows = table.getElementsByTagName('tr');
            let totalStudents = 0;
            let totalAbsent = 0;

            for (let i = 1; i < rows.length - 1; i++) {
                const studentCount = parseInt(rows[i].cells[2].innerText) || 0; 
                const absentCount = parseInt(rows[i].cells[3].innerText) || 0; 

                totalStudents += studentCount;
                totalAbsent += absentCount;
            }

            document.getElementById('sumTotalStudents').innerText = totalStudents;
            document.getElementById('sumTotalAbsent').innerText = totalAbsent;
        }

        function saveData(className, button) {
            const absentCount = document.getElementById(`absent-${className}`).innerText;
            if (absentCount) {
                fetch('/api/data') // Ваш API
                    .then(response => response.json())
                    .then(data => {
                        // Сохраняем новый класс в объекте
                        data[className] = absentCount;

                        fetch('/api/data', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        }).then(response => {
                            if (response.ok) {
                                button.innerText = "СОХРАНЕНО";
                                button.classList.add("saved");
                                alert(`Данные для класса ${className} сохранены!`);
                            } else {
                                alert("Ошибка при сохранении данных.");
                            }
                        }).catch(err => {
                            alert("Ошибка при сохранении данных.");
                            console.error(err);
                        });
                    });
            } else {
                alert(`Введите число для класса ${className}.`);
            }
        }

        function loadSavedData() {
            fetch('/api/data') // Ваш API
                .then(response => response.json())
                .then(classData => {
                    for (const [className, absentCount] of Object.entries(classData)) {
                        const absentCell = document.getElementById(`absent-${className}`);
                        if (absentCell) {
                            absentCell.innerText = absentCount; 
                        }
                    }
                    calculateSums(); 
                })
                .catch(err => {
                    console.error("Ошибка при загрузке данных:", err);
                });
        }

        window.onload = function() {
            loadSavedData(); 
        };
    </script>
</body>
</html>
